{# templates/course/show.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}{{ course.title }}{% endblock %}

{% block body %}
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-8">
                <h1>{{ course.title }}</h1>

                <!-- Affichage des tags -->
                <div class="tags-container mb-3">
                    {% for tag in course.tags %}
                        <span class="badge bg-primary">{{ tag.name }}</span>
                    {% endfor %}
                </div>

                <p class="lead">{{ course.description }}</p>

                <div class="video-container mb-4">
                    <div id="player"></div>
                </div>

                <div id="quiz-button-container" class="text-center" style="display: none;">
                    <a href="{{ path('app_quiz_show', {'id': course.quiz.id}) }}" class="btn btn-primary btn-lg">
                        Passer le test
                    </a>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5>Informations du cours</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>Créé le :</strong> {{ course.createdAt|date('d/m/Y H:i') }}</p>
                        <p><strong>Dernière mise à jour :</strong> {{ course.updatedAt|date('d/m/Y H:i') }}</p>
                        <p><strong>Quiz associé :</strong> {{ course.quiz.name }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chargement de l'API YouTube -->
    <script>
        // Cette variable globale sera utilisée par l'API YouTube
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        var player;
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '390',
                width: '640',
                videoId: '{{ course.youtubeVideoId }}',
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
            event.target.playVideo();
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.ENDED) {
                document.getElementById('quiz-button-container').style.display = 'block';
            }
        }
    </script>

    <style>
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* Ratio 16:9 */
            height: 0;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .video-container #player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .tags-container {
            margin-bottom: 1rem;
        }
        .badge {
            margin-right: 5px;
        }
    </style>
{% endblock %}
